<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,Chrome=1" />
  <title>JS-Piano</title>
  <!-- Library -->
  <script src="./Library/jquery-3.6.0.js"></script>
  <script src="./Library/vue.js"></script>
  <link rel="stylesheet" href="./Library/component.css">
  <link rel="stylesheet" href="./Library/blue-component.css">
  <script src="./Library/layer/layer.js"></script>
  <script src="./Library/FileSaver/FileSaver.min.js"></script>
  <script src="./Public/api.js"></script>
  <script src="./Public/JS-Piano.js"></script>
  <script src="./res/instruments.js"></script>
  <link rel="stylesheet" href="./Public/index.css">
  <!-- Music_G -->
  <script src="./Music_G/su.js"></script>
</head>

<body>
  <div id="app">
    <div class="IDE">
      <!-- 吸顶层 -->
      <div class="fixedTop"></div>
      <!-- 内容包络 -->
      <div class="PianoBlock bc-flex" style="width:max-content;">
        <!-- 吸边钢琴栏 -->
        <div class="fixedLeft piano-area bc-flex bc-flex-d-cr fs-none">
          <div v-for="(group,gi) in Piano" class="Ver8 bc-flex bc-flex-d-cr bc-flex-jc-c bc-flex-ai-s bc-t-999 bc-f-13rp ps-r" style="width:90px;">
            <!-- 0 2 4 5 7 9 11 -->
            <!-- 1 3 6 8 10 -->
            <div v-for="(kb,ki) in group" class="piano-key" :scale="kb.scale" :class="ki==1||ki==3||ki==6||ki==8||ki==10 ? 'blackKey' : 'whiteKey'" :style="(ki==1||ki==3||ki==6||ki==8||ki==10 ? ('height:' + KeyWidth + 'px;line-height:' + KeyWidth + 'px;') : (gi==0 ? 'height:'+KeyWidth*1.5+'px;'+'line-height:'+KeyWidth*1.5+'px' : gi==8 ? 'height:'+KeyWidth+'px;'+'line-height:'+KeyWidth+'px' : (ki==2||ki==7||ki==9 ? ('height:' + KeyWidth*2 + 'px;line-height:' + KeyWidth*2 + 'px;') : ('height:' + KeyWidth*1.5 + 'px;line-height:' + KeyWidth*1.5 + 'px;')))) + 
            (ki!=10 ? (ki!=8 ? (ki!=6 ? (ki!=3 ? (ki!=1 ? '' : (gi == 0 ? 'top:'+KeyWidth*1.5+'px' : 'top:'+KeyWidth*10.5+'px')) : 'top:'+KeyWidth*8.5+'px') : 'top:'+KeyWidth*5.5+'px') : 'top:'+KeyWidth*3.5+'px') : 'top:'+KeyWidth*1.5+'px;')">{{kb.key}}--{{gi}}</div>
          </div>
        </div>
        <!-- IDE-Chart -->
        <div class="IDE-Chart fs-none bc-flex">
          <div class="charts">
            <div v-for="(grid,index) in Chart" class="grid bc-t-999">{{index}}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var vm = new Vue({
      el: "#app",
      beforeCreate() {
        window.Editor = new Object;
      },
      data: {
        Piano: E_PIANO,
        Chart: [],
        KeyWidth: 24,
      },
      mounted() {
        var CHART = [];
        E_PIANO.forEach(function(item) {
          CHART = CHART.concat(item);
        });
        this.Chart = CHART.reverse();

        E_PIANO.forEach(function(group, gi) {
          group.forEach(function(key, ki) {
            if (ki == 1 || ki == 3 || ki == 6 || ki == 8 || ki == 10) { // TODO: 不要在html中实时计算，在data中插值以便后期维护
              key.area = this.KeyWidth;
            }
            console.log(key.key, ki);
          });
        });
        // window.pianist();
      },
    })

    setTimeout(function() {
      $(".IDE-Chart").css('height', $(".piano-area").innerHeight()); // 表格层高度脚手架，框架完成后可删除
    })

    // 播放控制 Music
    var Music = Su;

    // title 初始化
    if (Music == Su) {
      document.title = "溯"
    } else if (Music != Su) {
      document.title = "Piano.js"
    }

    var isClick = false;
    // 按键判定前置
    $(window).mousedown(function() {
      isClick = true;
    });
    $(window).mouseup(function() {
      isClick = false;
      cleanAct();
    });
    $(".piano-key").mouseout(function() {
      cleanAct();
    });
    // 按键判定
    $(".piano-key").mouseover(function() {
      if (isClick) {
        createAudio($(this).attr('scale'));
      }
    });

    var NavView;
    // 页面加载播放
    window.onload = function() {
      if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
        // console.log("Wap");
        NavView = "wap";
        // "..."为spread运算符，ES6语法
        [...document.querySelectorAll('.piano-key')].forEach(function(item) {
          item.addEventListener('touchstart', function() {
            createAudio($(this).attr('scale'));
          });
        });
      } else {
        // console.log("Pc");
        NavView = "pc";
        $(".piano-key").mousedown(function() {
          createAudio($(this).attr('scale'));
        });
      }
    }
    var KeyboardVol = 0.3;
  </script>
</body>

</html>